<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
	<mapper namespace="NsBoard">
		<select id="SelectListByType" resultType="MyBoard" parameterType="HashMap">
			select seq_brd, brd_hitnum, brd_subject,brd_content, to_char(brd_inputdate,'YYYY/MM/DD') as brd_inputdate, mid 
			from board where brd_type = #{brd_type} order by seq_brd desc 
		</select>
		
		<update id="UpdateHitnum" parameterType="Integer">
			update board set brd_hitnum = brd_hitnum+1 where seq_brd = #{seq_brd}
		</update>
		
		<!-- 여기 3중 조인해야됨 -->
		<select id="SelectComments" resultType="MyBoard">
			select m.mid as mid, m.name as name,c.comt_content as comt_content, c.comt_inputdate as comt_inputdate
			from (board b inner join comments c on b.seq_brd = c.seq_brd)
			inner join member m on c.mid = m.mid
			 where b.seq_brd = #{seq_brd} order by c.seq_comt desc
		</select>
		
		<select id="SelectBoardList" resultType="MyBoard" >
			select m.mid as mid , m.name as name, b.brd_subject as brd_subject
			,b.brd_content as brd_content,b.brd_inputdate as brd_inputdate,b.brd_hitnum as brd_hitnum, b.seq_brd as seq_brd
			from board b inner join member m on b.mid = m.mid where b.seq_brd = #{seq_brd}
		</select>
		
		<insert id="WriteBoard" parameterType="MyBoard">
			insert into board values(seq_brd.nextval, #{mid}, #{brd_type}, #{brd_subject},
			#{brd_content}, sysdate, 0)
		</insert>
		
		<select id="SelectListByKeyword" resultType="MyBoard" parameterType="HashMap">
			select seq_brd, brd_hitnum, brd_subject,brd_content, to_char(brd_inputdate,'YYYY/MM/DD') as brd_inputdate, mid
			from board where brd_type = #{brd_type} and 
			<if test="mode == 'mid'">
				mid like #{keyword}
			</if>
			<if test="mode == 'brd_subject'">
				brd_subject like #{keyword}
			</if>
			 order by seq_brd desc			
		</select>
		
		<select id="SelectListCnt" parameterType="Integer" resultType="Integer">
			select count(*) as cnt from board where brd_type = #{brd_type}
		</select>
		
		<select id="SelectListSearchCnt" parameterType="Integer" resultType="Integer">
			select count(*) as cnt from board where brd_type = #{brd_type} and
			<if test="mode == 'mid'">
				mid like #{keyword}
			</if>
			<if test="mode == 'brd_subject'">
				brd_subject like #{keyword}
			</if>
			 order by seq_brd desc	
		</select>
		
		<select id="SelectcurrVal" resultType="Integer">
			select * from (select seq_brd from board order by seq_brd desc) where rownum = 1
		</select>
		
		<insert id="insertFile">
			insert into boardfile values(seq_file.nextval, #{seq_brd}, #{file_name}, #{file_location}, #{file_size})
		</insert>
		
		<select id="SelectFileList" resultType="MyBoard">
			select file_name from boardfile where seq_brd = #{seq_brd}
		</select>
		
	</mapper>
	
	